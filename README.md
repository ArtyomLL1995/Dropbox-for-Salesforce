# Dropbox-for-Salesforce

In Dropbox_Service class there are number of methods that allow to interact with Dropbox api, such as upload file to Dropbox from Salesforce and directly from Javascript. Creating folder in dropbox, getting folder / file info, getting content of a folder info, searching within Dropbox account.

Later planning to add method which will allow to download files from Dropbox to local machine.

Before configuring Salesforce you must have a Dropbox account and a properly setup connected app in Dropbox account. To create connected app in Dropbox go to https://www.dropbox.com/developers -> App Console -> Create App

After you create your connected app in Dropbox you can setup Named Credentials and Auth Provider in Salesforce so you can have access to Dropbox API.

1. Create Auth provider. Go to your org. Setup -> auth provider -> click 'New'
Provider type : Open ID Connect. Choose any name, for example : Dropbox;
Consumer key : client id from your connected app from Dropbox;
Consumer Secret : client secret from your connected app from Dropbox;
Authorize Endpoint URL : https://www.dropbox.com/oauth2/authorize?token_access_type=offline;
Token Endpoint URL : https://api.dropboxapi.com/oauth2/token -> 
Click 'Save' -> Go to Salesforce configuration at the bottom of the page. Take Callback URL that is
generated by the system and paste it into your connected app in Dropbox.

2. Create Named credentials. Go to setup -> 'Named credentials' -> open tab 'External credentials'
-> click 'New' Label : Dropbox; Name : Dropbox; Authentication Protocol : Auth 2.0;
Authentication Provider : Dropbox (created on previous step) -> click 'Save'

3. Go back to 'Named credentials' tab. Under tab 'Named credentials' click 'New'
Label : Dopbbox; Name : Dropbox; URL : https://api.dropboxapi.com/2;
External Credential : Dropbox (created on previuos step) -> click 'Save'

4. Go back to 'Named credentials' tab. Under tab 'Named credentials' click 'New'
Label : DropboxContent; URL : https://content.dropboxapi.com/2/
External Credential : Dropbox -> click 'Save'

5. Set up permission set mapping. Go to setup -> permission sets -> click 'New' -> Label : (Choose any); License : ('Salesforce' or other license
(License from permission set must be the same that the user licenses who will be using this permission set)) -> click 'Save'
-> Assign this permission set to those users who will be using the integration

6. Go back to 'Dropbox' external named credential. Under 'Permission Set Mappings' tile click 'New' -> Choose permission set creaded on the previous step
-> Identity type 'Named principal' -> click 'Save'

7. Under added permission set mapping under 'Actions' column click down arrow -> 'Authenticate' -> You will be
redirected to Dropbox login page and after you authorize to Dropbox 'Authentication Status' must change to 'Configured'

8. If something went wrong with authentication try another way. Click 'Edit' on permission set mapping -> change Identity type to 'Per User Principal' ->
Go to your personal user settings -> Under 'My personal information' click 'External Credentials' -> click 'Authenticate' on 'Dropbox' named 
credential, created on the previous steps.

9. In case integration still not working you can create legacy credentials. Go to Named Credentials -> New legacy -> Label : Dopbbox; Name : Dopbbox; URL : https://api.dropboxapi.com/2; Identity Type : Named Proncipal; Authentication Protocol : Auth 2.0; Authentication Provider : Dropbox -> Save

10. Repeat this step for second credential. New legacy -> Label : DropboxContent; Name : DropboxContent; URL : https://content.dropboxapi.com/2/; Identity Type : Named Proncipal; Authentication Protocol : Auth 2.0; Authentication Provider : Dropbox -> Save

Now if everything is setup correctly you must have access to the API
